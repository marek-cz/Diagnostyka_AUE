/*
 * DAC_moje.c
 *
 * Created: 2019-11-05 17:27:29
 *  Author: Marek
 */ 

#include <avr/io.h>
#include "DAC_moje.h"

/*********************************************************************************************/

void DAC_init(void) // na ATXMEGA256A3BU jest jeden DAC na porcie B -> DACB PB2 - CH0 PB3 - CH1
{
	DACB.CTRLC = DAC_REFSEL_INT1V_gc;          //Wewn. napiêcie ref. 1 V
	DACB.CTRLB = DAC_CH0TRIG_bm;               //Konwersja wyzwalana zdarzeniem
	DACB.EVCTRL = DAC_EVSEL_0_gc;              //EvCh 0 - kanal 0 systemu zdarzen wyzwala konwersje
	DACB.CTRLA = DAC_ENABLE_bm | DAC_CH0EN_bm; //W³¹cz DAC, kana³ 0 routowany na IO (PB2) - ADC2 NA PLYTCE
}

void UstawDACa(uint16_t rejestrDACa)
{
	DACB.CH0DATA = rejestrDACa;	// wpisz wartosc do rejestru -> wystaw na wyjscie
	while ( ( DACB.STATUS & DAC_CH0DRE_bm ) == 0 ); // czekaj na wystawienie 0
}

/***************************************************************************************************/

// tablice z probkami przebiegow

const uint16_t multi_sin_wave_500[LICZBA_PROBEK_W_TABLICY_MAX] PROGMEM = {
	840 ,874 ,921 ,982 ,1056,1142,1239,1346,1461,1583,1711,1842,1976,2110,2243,2373,
	2499,2619,2732,2836,2930,3013,3084,3142,3186,3217,3233,3234,3222,3194,3154,3100,
	3033,2955,2866,2768,2661,2548,2429,2306,2180,2054,1927,1803,1682,1566,1455,1352,
	1257,1171,1095,1030,977 ,935 ,905 ,888 ,883 ,890 ,908 ,939 ,979 ,1031,1091,1160,
	1237,1321,1410,1504,1602,1702,1803,1905,2007,2107,2205,2300,2390,2477,2558,2634,
	2704,2768,2826,2877,2922,2961,2994,3021,3042,3058,3069,3076,3078,3078,3074,3067,
	3058,3047,3034,3021,3006,2990,2974,2958,2941,2923,2906,2887,2868,2848,2826,2803,
	2779,2753,2724,2692,2658,2621,2580,2536,2488,2437,2381,2322,2259,2193,2123,2051,
	1976,1898,1820,1739,1659,1579,1499,1421,1346,1274,1205,1141,1083,1031,985 ,946 ,
	916 ,894 ,880 ,876 ,881 ,895 ,919 ,952 ,994 ,1045,1105,1172,1247,1330,1418,1512,
	1610,1712,1817,1924,2032,2140,2246,2352,2454,2553,2647,2737,2821,2898,2969,3033,
	3089,3138,3180,3213,3240,3258,3270,3276,3274,3268,3256,3239,3219,3196,3170,3142,
	3113,3084,3055,3028,3001,2977,2955,2936,2921,2909,2900,2896,2895,2897,2904,2913,
	2926,2941,2959,2978,2999,3020,3041,3062,3081,3099,3114,3127,3135,3140,3141,3136,
	3126,3111,3090,3063,3030,2992,2947,2897,2841,2780,2715,2645,2571,2494,2415,2333,
	2249,2165,2081,1996,1913,1832,1753,1677,1604,1534,1469,1409,1353,1303,1258,1218,
	1184,1156,1133,1115,1102,1094,1091,1092,1098,1107,1119,1134,1151,1171,1192,1215,
	1238,1262,1285,1309,1332,1354,1376,1396,1414,1431,1447,1460,1472,1483,1491,1497,
	1502,1506,1507,1507,1506,1503,1499,1494,1488,1480,1472,1462,1452,1440,1428,1415,
	1400,1385,1369,1352,1333,1314,1294,1272,1250,1227,1202,1177,1152,1125,1099,1072,
	1045,1018,992 ,967 ,942 ,920 ,899 ,880 ,864 ,850 ,840 ,834 ,831 ,832 ,839 ,849 ,
	865 ,886 ,912 ,944 ,981 ,1023,1070,1122,1178,1239,1304,1373,1444,1519,1595,1672,
	1750,1829,1906,1982,2056,2128,2196,2260,2319,2373,2422,2464,2500,2529,2552,2567,
	2575,2576,2570,2558,2539,2514,2484,2448,2408,2365,2318,2269,2219,2168,2117,2066,
	2018,1971,1927,1887,1851,1820,1794,1773,1757,1748,1744,1746,1754,1767,1786,1809,
	1836,1867,1900,1936,1973,2012,2050,2087,2122,2155,2185,2211,2232,2248,2259,2263,
	2261,2252,2236,2213,2184,2148,2107,2059,2007,1950,1889,1825,1760,1693,1627,1561,
	1498,1437,1381,1330,1285,1248,1218,1196,1184,1182,1190,1208,1236,1275,1325,1384,
	1453,1530,1616,1709,1808,1913,2021,2133,2245,2358,2469,2578,2683,2782,2874,2958,
	3033,3098,3151,3192,3221,3236,3238,3226,3201,3161,3109,3044,2966,2878,2779,2671,
	2555,2432,2305,2174,2041,1908,1776,1647,1522,1404,1293,1191,1100,1019,952 ,897 ,
	856 ,830 ,819 ,822
};



const uint16_t sinc_wave_500[LICZBA_PROBEK_W_TABLICY_MAX] PROGMEM = {
	1257,1249,1241,1233,1225,1218,1212,1206,1201,1197,1193,1191,1189,1189,1190,1192,
	1195,1199,1203,1209,1216,1223,1231,1239,1248,1257,1266,1275,1283,1292,1300,1307,
	1314,1319,1324,1328,1331,1332,1332,1332,1330,1326,1322,1317,1310,1303,1295,1286,
	1277,1267,1257,1247,1237,1227,1217,1208,1200,1193,1186,1181,1176,1173,1172,1171,
	1172,1174,1178,1183,1189,1196,1204,1214,1224,1234,1245,1257,1268,1280,1291,1302,
	1312,1322,1330,1338,1344,1349,1353,1355,1356,1355,1352,1348,1343,1336,1327,1318,
	1307,1295,1283,1270,1257,1243,1230,1217,1204,1192,1180,1170,1161,1154,1148,1143,
	1141,1140,1141,1144,1148,1155,1163,1173,1184,1197,1211,1225,1241,1257,1273,1289,
	1305,1321,1336,1349,1362,1373,1382,1390,1395,1399,1400,1399,1396,1390,1382,1373,
	1361,1347,1331,1314,1296,1277,1257,1236,1216,1196,1176,1157,1140,1124,1109,1097,
	1087,1080,1075,1073,1073,1077,1084,1093,1106,1121,1139,1159,1181,1205,1230,1257,
	1284,1312,1339,1366,1392,1416,1439,1459,1477,1492,1503,1511,1515,1516,1511,1503,
	1491,1474,1453,1428,1400,1368,1334,1296,1257,1216,1174,1131,1089,1047,1007,969 ,
	934 ,902 ,875 ,852 ,835 ,824 ,819 ,820 ,829 ,846 ,870 ,902 ,942 ,990 ,1046,1109,
	1179,1257,1341,1431,1526,1625,1729,1836,1944,2055,2165,2275,2384,2490,2593,2691,
	2785,2872,2952,3025,3090,3145,3192,3228,3254,3270,3276,3270,3254,3228,3192,3145,
	3090,3025,2952,2872,2785,2691,2593,2490,2384,2275,2165,2055,1944,1836,1729,1625,
	1526,1431,1341,1257,1179,1109,1046,990 ,942 ,902 ,870 ,846 ,829 ,820 ,819 ,824 ,
	835 ,852 ,875 ,902 ,934 ,969 ,1007,1047,1089,1131,1174,1216,1257,1296,1334,1368,
	1400,1428,1453,1474,1491,1503,1511,1516,1515,1511,1503,1492,1477,1459,1439,1416,
	1392,1366,1339,1312,1284,1257,1230,1205,1181,1159,1139,1121,1106,1093,1084,1077,
	1073,1073,1075,1080,1087,1097,1109,1124,1140,1157,1176,1196,1216,1236,1257,1277,
	1296,1314,1331,1347,1361,1373,1382,1390,1396,1399,1400,1399,1395,1390,1382,1373,
	1362,1349,1336,1321,1305,1289,1273,1257,1241,1225,1211,1197,1184,1173,1163,1155,
	1148,1144,1141,1140,1141,1143,1148,1154,1161,1170,1180,1192,1204,1217,1230,1243,
	1257,1270,1283,1295,1307,1318,1327,1336,1343,1348,1352,1355,1356,1355,1353,1349,
	1344,1338,1330,1322,1312,1302,1291,1280,1268,1257,1245,1234,1224,1214,1204,1196,
	1189,1183,1178,1174,1172,1171,1172,1173,1176,1181,1186,1193,1200,1208,1217,1227,
	1237,1247,1257,1267,1277,1286,1295,1303,1310,1317,1322,1326,1330,1332,1332,1332,
	1331,1328,1324,1319,1314,1307,1300,1292,1283,1275,1266,1257,1248,1239,1231,1223,
	1216,1209,1203,1199,1195,1192,1190,1189,1189,1191,1193,1197,1201,1206,1212,1218,
	1225,1233,1241,1249
};



const uint16_t sinus_500[LICZBA_PROBEK_W_TABLICY_MAX] PROGMEM = {
	2047,2062,2078,2093,2109,2124,2140,2155,2170,2186,2201,2216,2232,2247,2262,2277,
	2292,2307,2323,2338,2353,2367,2382,2397,2412,2427,2441,2456,2470,2485,2499,2514,
	2528,2542,2556,2570,2584,2598,2612,2625,2639,2652,2666,2679,2692,2705,2718,2731,
	2744,2757,2769,2782,2794,2806,2818,2830,2842,2854,2865,2877,2888,2899,2910,2921,
	2932,2943,2953,2963,2974,2984,2994,3003,3013,3022,3032,3041,3050,3059,3067,3076,
	3084,3092,3100,3108,3116,3124,3131,3138,3145,3152,3159,3165,3171,3178,3183,3189,
	3195,3200,3205,3211,3215,3220,3225,3229,3233,3237,3241,3244,3248,3251,3254,3257,
	3259,3262,3264,3266,3268,3269,3271,3272,3273,3274,3275,3275,3275,3276,3275,3275,
	3275,3274,3273,3272,3271,3269,3268,3266,3264,3262,3259,3257,3254,3251,3248,3244,
	3241,3237,3233,3229,3225,3220,3215,3211,3205,3200,3195,3189,3183,3178,3171,3165,
	3159,3152,3145,3138,3131,3124,3116,3108,3100,3092,3084,3076,3067,3059,3050,3041,
	3032,3022,3013,3003,2994,2984,2974,2963,2953,2943,2932,2921,2910,2899,2888,2877,
	2865,2854,2842,2830,2818,2806,2794,2782,2769,2757,2744,2731,2718,2705,2692,2679,
	2666,2652,2639,2625,2612,2598,2584,2570,2556,2542,2528,2514,2499,2485,2470,2456,
	2441,2427,2412,2397,2382,2367,2353,2338,2323,2307,2292,2277,2262,2247,2232,2216,
	2201,2186,2170,2155,2140,2124,2109,2093,2078,2062,2047,2032,2016,2001,1985,1970,
	1954,1939,1924,1908,1893,1878,1862,1847,1832,1817,1802,1787,1771,1756,1741,1727,
	1712,1697,1682,1667,1653,1638,1624,1609,1595,1580,1566,1552,1538,1524,1510,1496,
	1482,1469,1455,1442,1428,1415,1402,1389,1376,1363,1350,1337,1325,1312,1300,1288,
	1276,1264,1252,1240,1229,1217,1206,1195,1184,1173,1162,1151,1141,1131,1120,1110,
	1100,1091,1081,1072,1062,1053,1044,1035,1027,1018,1010,1002,994 ,986 ,978 ,970 ,
	963 ,956 ,949 ,942 ,935 ,929 ,923 ,916 ,911 ,905 ,899 ,894 ,889 ,883 ,879 ,874 ,
	869 ,865 ,861 ,857 ,853 ,850 ,846 ,843 ,840 ,837 ,835 ,832 ,830 ,828 ,826 ,825 ,
	823 ,822 ,821 ,820 ,819 ,819 ,819 ,819 ,819 ,819 ,819 ,820 ,821 ,822 ,823 ,825 ,
	826 ,828 ,830 ,832 ,835 ,837 ,840 ,843 ,846 ,850 ,853 ,857 ,861 ,865 ,869 ,874 ,
	879 ,883 ,889 ,894 ,899 ,905 ,911 ,916 ,923 ,929 ,935 ,942 ,949 ,956 ,963 ,970 ,
	978 ,986 ,994 ,1002,1010,1018,1027,1035,1044,1053,1062,1072,1081,1091,1100,1110,
	1120,1131,1141,1151,1162,1173,1184,1195,1206,1217,1229,1240,1252,1264,1276,1288,
	1300,1312,1325,1337,1350,1363,1376,1389,1402,1415,1428,1442,1455,1469,1482,1496,
	1510,1524,1538,1552,1566,1580,1595,1609,1624,1638,1653,1667,1682,1697,1712,1727,
	1741,1756,1771,1787,1802,1817,1832,1847,1862,1878,1893,1908,1924,1939,1954,1970,
	1985,2001,2016,2032
};

const uint16_t sinus_250[250] PROGMEM = {
	2047,2078,2109,2140,2170,2201,2232,2262,2292,2323,2353,2382,2412,2441,2470,2499,
	2528,2556,2584,2612,2639,2666,2692,2718,2744,2769,2794,2818,2842,2865,2888,2910,
	2932,2953,2974,2994,3013,3032,3050,3067,3084,3101,3116,3131,3145,3159,3171,3184,
	3195,3206,3215,3225,3233,3241,3248,3254,3259,3264,3268,3271,3273,3275,3276,3276,
	3275,3273,3271,3268,3264,3259,3254,3248,3241,3233,3225,3215,3206,3195,3184,3171,
	3159,3145,3131,3116,3101,3084,3067,3050,3032,3013,2994,2974,2953,2932,2910,2888,
	2865,2842,2818,2794,2769,2744,2718,2692,2666,2639,2612,2584,2556,2528,2499,2470,
	2441,2412,2382,2353,2323,2292,2262,2232,2201,2170,2140,2109,2078,2047,2016,1985,
	1954,1924,1893,1862,1832,1802,1771,1741,1712,1682,1653,1624,1595,1566,1538,1510,
	1482,1455,1428,1402,1376,1350,1325,1300,1276,1252,1229,1206,1184,1162,1141,1120,
	1100,1081,1062,1044,1027,1010,993 ,978 ,963 ,949 ,935 ,923 ,910 ,899 ,888 ,879 ,
	869 ,861 ,853 ,846 ,840 ,835 ,830 ,826 ,823 ,821 ,819 ,819 ,819 ,819 ,821 ,823 ,
	826 ,830 ,835 ,840 ,846 ,853 ,861 ,869 ,879 ,888 ,899 ,910 ,923 ,935 ,949 ,963 ,
	978 ,993 ,1010,1027,1044,1062,1081,1100,1120,1141,1162,1184,1206,1229,1252,1276,
	1300,1325,1350,1376,1402,1428,1455,1482,1510,1538,1566,1595,1624,1653,1682,1712,
	1741,1771,1802,1832,1862,1893,1924,1954,1985,2016
};

const uint16_t sinus_100[100] PROGMEM = {
	2047,2124,2201,2277,2353,2427,2499,2570,2639,2705,2769,2830,2888,2943,2994,3041,
	3084,3124,3159,3189,3215,3237,3254,3266,3273,3276,3273,3266,3254,3237,3215,3189,
	3159,3124,3084,3041,2994,2943,2888,2830,2769,2705,2639,2570,2499,2427,2353,2277,
	2201,2124,2047,1970,1893,1817,1741,1667,1595,1524,1455,1389,1325,1264,1206,1151,
	1100,1053,1010,970 ,935 ,905 ,879 ,857 ,840 ,828 ,821 ,819 ,821 ,828 ,840 ,857 ,
	879 ,905 ,935 ,970 ,1010,1053,1100,1151,1206,1264,1325,1389,1455,1524,1595,1667,
	1741,1817,1893,1970
};


